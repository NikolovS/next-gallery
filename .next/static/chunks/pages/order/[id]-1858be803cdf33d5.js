(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[441],{840:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/order/[id]",function(){return c(5637)}])},2913:function(c,b,a){"use strict";a.d(b,{Z:function(){return i}});var d=a(5893),e=a(5357),f=a(1594),g=a(2876);a(7294);var h=a(9629);function i(b){var a=b.activeStep,c=(0,h.Z)();return(0,d.jsx)(e.Z,{className:c.transperantBackground,activeStep:void 0===a?0:a,alternativeLabel:!0,children:["Login","Shipping Address","Payment Method","Place Order"].map(function(a){return(0,d.jsx)(f.Z,{children:(0,d.jsx)(g.Z,{children:a})},a)})})}},5637:function(i,b,a){"use strict";a.r(b),a.d(b,{"__N_SSP":function(){return R}});var j=a(7568),k=a(6042),l=a(9396),m=a(828),c=a(4051),n=a.n(c),o=a(5893),p=a(7294),d=a(5152),e=a.n(d),q=a(5789),r=a(8766),f=a(1664),s=a.n(f),g=a(5675),t=a.n(g),u=a(2318),v=a(5477),w=a(1749),x=a(8463),y=a(2822),z=a(998),A=a(6847),B=a(2302),C=a(3750),D=a(7394),E=a(8222),F=a(9613),G=a(9659),H=a(282),h=a(9669),I=a.n(h),J=a(1163),K=a(9629),L=a(2913),M=a(1419),N=a(5021),O=a(6935);function P(a,b){switch(b.type){case"FETCH_REQUEST":return(0,l.Z)((0,k.Z)({},a),{loading:!0,error:""});case"FETCH_SUCCESS":return(0,l.Z)((0,k.Z)({},a),{loading:!1,order:b.payload,error:""});case"FETCH_FAILED":return(0,l.Z)((0,k.Z)({},a),{loading:!1,error:b.payload});case"PAY_REQUEST":return(0,l.Z)((0,k.Z)({},a),{loadingPay:!0});case"PAY_SUCCESS":return(0,l.Z)((0,k.Z)({},a),{loadingPay:!1,successPay:!0});case"PAY_FAILED":return(0,l.Z)((0,k.Z)({},a),{loadingPay:!1,errorPay:b.payload});case"PAY_RESET":return(0,l.Z)((0,k.Z)({},a),{loadingPay:!1,errorPay:"",successPay:!1});case"DELIVER_REQUEST":return(0,l.Z)((0,k.Z)({},a),{loadingDeliver:!0});case"DELIVER_SUCCESS":return(0,l.Z)((0,k.Z)({},a),{loadingDeliver:!1,successDeliver:!0});case"DELIVER_FAIL":return(0,l.Z)((0,k.Z)({},a),{loadingDeliver:!1,errorDeliver:b.payload});case"DELIVER_RESET":return(0,l.Z)((0,k.Z)({},a),{loadingDeliver:!1,successDeliver:!1,errorDeliver:""})}}function Q(k){var ad,e=k.params.id,f=(0,m.Z)((0,N.Up)(),2),l=f[0].isPending,ae=f[1],b=(0,K.Z)(),af=(0,J.useRouter)(),Q=(0,p.useContext)(r.y).state,R=Q.userInfo,ag=(0,O.Ds)().enqueueSnackbar,g=(0,p.useReducer)(P,{loading:!0,order:{},error:""}),c=g[0],S=c.loading,h=c.error,a=c.order,T=c.successPay,U=c.loadingDeliver,V=c.successDeliver,ah=g[1],d=a.shippingAddress,W=a.paymentMethod,X=a.orderItems,Y=a.itemsPrice,Z=a.taxPrice,$=a.shippingPrice,_=a.totalPrice,aa=a.deliveredAt,ab=a.isDelivered,i=a.isPaid,ac=a.paidAt;function ai(){return(ai=(0,j.Z)(n().mark(function b(){var c;return n().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,ah({type:"DELIVER_REQUEST"}),b.next=4,I().put("/api/orders/".concat(a._id,"/deliver"),{},{headers:{authorization:"Bearer ".concat(R.token)}});case 4:ah({type:"DELIVER_SUCCESS",payload:c=b.sent.data}),ag("Order is delivered",{variant:"success"}),b.next=13;break;case 9:b.prev=9,b.t0=b.catch(0),ah({type:"DELIVER_FAIL",payload:(0,M.b)(b.t0)}),ag((0,M.b)(b.t0),{variant:"error"});case 13:case"end":return b.stop()}},b,null,[[0,9]])}))).apply(this,arguments)}return(0,p.useEffect)(function(){if(!R)return af.push("/login");var b,c,d=(c=(0,j.Z)(n().mark(function a(){var b;return n().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,ah({type:"FETCH_REQUEST"}),a.next=4,I().get("/api/orders/".concat(e),{headers:{authorization:"Bearer ".concat(R.token)}});case 4:ah({type:"FETCH_SUCCESS",payload:b=a.sent.data}),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),ah({type:"FETCH_FAIL",paylod:(0,M.b)(a.t0)});case 11:case"end":return a.stop()}},a,null,[[0,8]])})),function(){return c.apply(this,arguments)});!a._id||T||V||a._id&&a._id!==e?(d(),T&&ah({type:"PAY_RESET"}),V&&ah({type:"DELIVER_RESET"})):(b=(0,j.Z)(n().mark(function a(){var b,c;return n().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,I().get("/api/keys/paypal",{headers:{authorization:"Bearer ".concat(R.token)}});case 2:ae({type:"resetOptions",value:{"client-id":c=(b=a.sent).data,currency:"USD"}}),ae({type:"setLoadingStatus",value:"pending"});case 6:case"end":return a.stop()}},a)})),function(){return b.apply(this,arguments)})()},[a,T,V]),(0,o.jsxs)(q.Z,{title:"Order ".concat(e),children:[(0,o.jsx)(L.Z,{activeStep:3}),(0,o.jsxs)(u.Z,{component:"h1",variant:"h1",children:["Order ",e]}),S?(0,o.jsx)(v.Z,{}):h?(0,o.jsx)(u.Z,{className:b.error,children:h}):(0,o.jsxs)(w.Z,{container:!0,spacing:1,children:[(0,o.jsxs)(w.Z,{item:!0,md:9,xs:12,children:[(0,o.jsx)(x.Z,{className:b.section,children:(0,o.jsxs)(y.Z,{children:[(0,o.jsx)(z.Z,{children:(0,o.jsx)(u.Z,{component:"h2",variant:"h2",children:"Shipping Address"})}),(0,o.jsxs)(z.Z,{children:[d.fullName,", ",d.address,","," ",d.city,", ",d.postalCode,","," ",d.country]}),(0,o.jsxs)(z.Z,{children:["Status:"," ",ab?"delivered at ".concat(aa):"not delivered"]})]})}),(0,o.jsx)(x.Z,{className:b.section,children:(0,o.jsxs)(y.Z,{children:[(0,o.jsx)(z.Z,{children:(0,o.jsx)(u.Z,{component:"h2",variant:"h2",children:"Payment Method"})}),(0,o.jsx)(z.Z,{children:W}),(0,o.jsxs)(z.Z,{children:["Status: ",i?"delivered at ".concat(ac):"not paid"]})]})}),(0,o.jsx)(x.Z,{className:b.section,children:(0,o.jsxs)(y.Z,{children:[(0,o.jsx)(z.Z,{children:(0,o.jsx)(u.Z,{component:"h2",variant:"h2",children:"Order Items"})}),(0,o.jsx)(z.Z,{children:(0,o.jsx)(A.Z,{children:(0,o.jsxs)(B.Z,{children:[(0,o.jsx)(C.Z,{children:(0,o.jsxs)(D.Z,{children:[(0,o.jsx)(E.Z,{children:"Image"}),(0,o.jsx)(E.Z,{children:"Name"}),(0,o.jsx)(E.Z,{align:"right",children:"Quantity"}),(0,o.jsx)(E.Z,{align:"right",children:"Price"})]})}),(0,o.jsx)(F.Z,{children:X.map(function(a){return(0,o.jsxs)(D.Z,{children:[(0,o.jsx)(E.Z,{children:(0,o.jsx)(s(),{href:"/product/".concat(a.slug),passHref:!0,children:(0,o.jsx)(G.Z,{children:(0,o.jsx)(t(),{src:a.image,alt:a.name,width:50,height:50})})})}),(0,o.jsx)(E.Z,{children:(0,o.jsx)(s(),{href:"/product/".concat(a.slug),passHref:!0,children:(0,o.jsx)(G.Z,{children:(0,o.jsx)(u.Z,{children:a.name})})})}),(0,o.jsx)(E.Z,{align:"right",children:a.quantity}),(0,o.jsxs)(E.Z,{align:"right",children:["$",a.price]})]},a._id)})})]})})})]})})]}),(0,o.jsx)(w.Z,{md:3,xs:12,children:(0,o.jsx)(x.Z,{className:b.section,children:(0,o.jsxs)(y.Z,{children:[(0,o.jsx)(z.Z,{children:(0,o.jsx)(u.Z,{variant:"h2",children:"Order Summary"})}),(0,o.jsx)(z.Z,{children:(0,o.jsxs)(w.Z,{container:!0,children:[(0,o.jsx)(w.Z,{item:!0,xs:6,children:(0,o.jsx)(u.Z,{children:"Items:"})}),(0,o.jsx)(w.Z,{item:!0,xs:6,children:(0,o.jsxs)(u.Z,{align:"right",children:["$",Y]})})]})}),(0,o.jsx)(z.Z,{children:(0,o.jsxs)(w.Z,{container:!0,children:[(0,o.jsx)(w.Z,{item:!0,xs:6,children:(0,o.jsx)(u.Z,{children:"Tax:"})}),(0,o.jsx)(w.Z,{item:!0,xs:6,children:(0,o.jsxs)(u.Z,{align:"right",children:["$",Z]})})]})}),(0,o.jsx)(z.Z,{children:(0,o.jsxs)(w.Z,{container:!0,children:[(0,o.jsx)(w.Z,{item:!0,xs:6,children:(0,o.jsx)(u.Z,{children:"Shipping:"})}),(0,o.jsx)(w.Z,{item:!0,xs:6,children:(0,o.jsxs)(u.Z,{align:"right",children:["$",$]})})]})}),(0,o.jsx)(z.Z,{children:(0,o.jsxs)(w.Z,{container:!0,children:[(0,o.jsx)(w.Z,{item:!0,xs:6,children:(0,o.jsx)(u.Z,{children:(0,o.jsx)("strong",{children:"Total:"})})}),(0,o.jsx)(w.Z,{item:!0,xs:6,children:(0,o.jsx)(u.Z,{align:"right",children:(0,o.jsxs)("strong",{children:["$",_]})})})]})}),!i&&(0,o.jsx)(z.Z,{children:l?(0,o.jsx)(v.Z,{}):(0,o.jsx)("div",{className:b.fullWidth,children:(0,o.jsx)(N.ch,{createOrder:function(b,a){return a.order.create({purchase_units:[{amount:{value:_}},]}).then(function(a){return a})},onApprove:function(d,b){var c;return b.order.capture().then((c=(0,j.Z)(n().mark(function b(c){var d;return n().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,ah({type:"PAY_REQUEST"}),b.next=4,I().put("/api/orders/".concat(a._id,"/pay"),c,{headers:{authorization:"Bearer ".concat(R.token)}});case 4:ah({type:"PAY_SUCCESS",payload:d=b.sent.data}),ag("Order is paid",{variant:"success"}),b.next=13;break;case 9:b.prev=9,b.t0=b.catch(0),ah({type:"PAY_FAIL",payload:(0,M.b)(b.t0)}),ag((0,M.b)(b.t0),{variant:"error"});case 13:case"end":return b.stop()}},b,null,[[0,9]])})),function(a){return c.apply(this,arguments)}))},onError:function(a){ag((0,M.b)(a),{variant:"error"})}})})}),R.isAdmin&&a.isPaid&&!a.isDelivered&&(0,o.jsxs)(z.Z,{children:[U&&(0,o.jsx)(v.Z,{}),(0,o.jsx)(H.Z,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(){return ai.apply(this,arguments)},children:"Deliver Order"})]})]})})})]})]})}var R=!0;b.default=e()(function(){return Promise.resolve(Q)},{ssr:!1})}},function(a){a.O(0,[961,101,125,675,324,389,789,774,888,179],function(){var b;return a(a.s=840)}),_N_E=a.O()}])